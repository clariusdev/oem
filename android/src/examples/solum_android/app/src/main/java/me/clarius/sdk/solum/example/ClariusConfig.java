package me.clarius.sdk.solum.example;

import android.util.Log;

import java.lang.reflect.Field;
import java.util.Optional;

/**
 * Get constants defined in class BuildConfig generated from file local.properties.
 * <p>
 * The constants are defined in file local.properties and added in the generated class BuildConfig by plugin secrets-gradle-plugin.
 * If a constant is missing from the file, it will not be added in class BuildConfig causing a compilation error if trying to access it.
 * This helper class uses reflection to read the fields only if they exist.
 * This is useful during development to import network values instead of typing them in the GUI.
 * <p>
 * Known properties:
 * - clariusScannerCert: the scanner cert here, obtained from https://cloud.clarius.com/api/public/v0/devices/oem/
 * - clariusScannerSSID: the scanner Wi-Fi Direct SSID, obtained from Bluetooth scanning
 * - clariusScannerPassphrase: the scanner Wi-Fi WPA2 passphrase, obtained from Bluetooth scanning
 */

public class ClariusConfig {
    private static final String TAG = "ClariusConfig";

    public static Optional<String> maybeCert() {
        return Optional.ofNullable((String) getFieldValue(BuildConfig.class, "clariusScannerCert"));
    }

    public static Optional<String> maybeSSID() {
        return Optional.ofNullable((String) getFieldValue(BuildConfig.class, "clariusScannerSSID"));
    }

    public static Optional<String> maybePassphrase() {
        return Optional.ofNullable((String) getFieldValue(BuildConfig.class, "clariusScannerPassphrase"));
    }

    private static Object getFieldValue(Class<?> fromClass, String name) {
        try {
            Field field = fromClass.getField(name);
            return field.get(null);
        } catch (NoSuchFieldException | IllegalAccessException e) {
            Log.w(TAG, "Trying to access property '" + name + "' which is missing from file 'local.properties'.");
        }
        return null;
    }
}
